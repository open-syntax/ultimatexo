ultimatexo.com {
    header {
        Strict-Transport-Security max-age=31536000;
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        X-XSS-Protection "1; mode=block"
        Referrer-Policy strict-origin-when-cross-origin
        Content-Security-Policy "default-src 'self'; script-src 'self' https://static.cloudflareinsights.com https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' https:; connect-src 'self' wss://ultimatexo.com ws://ultimatexo.com https:;"
    }

    tls {$CLOUDFLARE_EMAIL} {
        dns cloudflare {$CLOUDFLARE_API_TOKEN}
    }

    @api_routes path /api/* /ws
    handle @api_routes {
            uri strip_prefix /api
            reverse_proxy server:6767 {
                health_uri /health
                health_interval 30s
                health_timeout 5s
                health_status 2xx
            }
    }

    handle {
        reverse_proxy client:8080 {
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
        }
    }

    log {
        output file /var/log/caddy/ultimatexo-access.log {
            roll_size 100mb
            roll_keep 3
        }
        format json
        level INFO
    }
}
